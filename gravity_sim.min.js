var GravitySim=function(a,b){function f(){KeyMouseEventHandlers.init(q);q.oncontextmenu=function(){return!1};a.onresize=function(){n=q.width=a.innerWidth;p=q.height=a.innerHeight}}function h(){for(var a=0;a<k.length;a++)for(var b=0;b<l.length;b++)k[a].addForceFrom(l[b]);for(a=0;a<l.length;a++)for(b=0;b<k.length;b++)l[a].addForceFrom(k[b]);for(a=0;a<k.length;a++)k[a].updatePosition();for(a=0;a<l.length;a++)l[a].updatePosition();t();w();x();m();e();setTimeout(h,y)}function t(){var a=eval("KeyMouseEventHandlers").getMousePosition();
if(eval("KeyMouseEventHandlers").mouseButtonDown(eval("KeyMouseEventHandlers").mouseCode.left))v||(v=!0,s=eval("KeyMouseEventHandlers").getMousePosition());else if(v){v=!1;var b=Misc.dist(a,s);k.push(new GravityWell({position:{x:(s.x-n/2)/c,y:(s.y-p/2)/c},density:1,radius:b,fillStyle:"red",useGradient:!0}))}v&&(g.beginPath(),a=Misc.dist(a,s),g.arc(s.x,s.y,a,0,2*Math.PI),g.fill())}function w(){var a=eval("KeyMouseEventHandlers").getMousePosition();eval("KeyMouseEventHandlers").mouseButtonDown(eval("KeyMouseEventHandlers").mouseCode.right)&&
l.push(new GravityWell({position:{x:(a.x-n/2)/c,y:(a.y-p/2)/c},density:1,radius:2,fillStyle:"black"}))}function x(){var a,b;eval("KeyMouseEventHandlers").keyDown(eval("KeyMouseEventHandlers").keyCode.left)?a=1:eval("KeyMouseEventHandlers").keyDown(eval("KeyMouseEventHandlers").keyCode.right)?a=-1:eval("KeyMouseEventHandlers").keyDown(eval("KeyMouseEventHandlers").keyCode.up)?b=1:eval("KeyMouseEventHandlers").keyDown(eval("KeyMouseEventHandlers").keyCode.down)&&(b=-1);a&&(k.forEach(function(b){b.position.x+=
a*d.panSpeed}),l.forEach(function(b){b.position.x+=a*d.panSpeed}));b&&(k.forEach(function(a){a.position.y+=b*d.panSpeed}),l.forEach(function(a){a.position.y+=b*d.panSpeed}))}function m(){eval("KeyMouseEventHandlers").keyDown(eval("KeyMouseEventHandlers").keyCode.pageUp)?c=c<d.maxScale?c+d.zoomSpeed*c:d.maxScale:eval("KeyMouseEventHandlers").keyDown(eval("KeyMouseEventHandlers").keyCode.pageDown)&&(c=c>d.minScale?c-d.zoomSpeed*c:d.minScale)}function e(){g.save();g.translate(n/2,p/2);g.scale(c,c);g.fillStyle=
"rgba(255,255,255,.5)";g.fillRect(-n/2/c,-p/2/c,n/c,p/c);k.forEach(function(a){a.render(g)});l.forEach(function(a){a.render(g)});g.restore()}var r,y,c,k,l,q,n,p,g,u,d,v,s;return{init:function(a,b){r=a;y=1E3*r;c=1;k=[];l=[];q=b;g=q.getContext("2d");g.webkitImageSmoothingEnabled=!0;n=q.width;p=q.height;f();d={zoomSpeed:.015,panSpeed:50,minScale:.1,maxScale:3,gravityStrength:.01};u=new dat.GUI;u.add(d,"zoomSpeed",.01,.05);u.add(d,"panSpeed",15,100);u.add(d,"minScale",.01,1);u.add(d,"maxScale",3,10);
u.add(d,"gravityStrength",0,.1);for(var e=0;25>e;e++){var m=new GravityWell({position:{x:Math.random()*n-n/2,y:Math.random()*p-p/2},density:1,radius:50*Math.random(),fillStyle:"red",useGradient:!0});k.push(m)}for(e=0;150>e;e++)m=new GravityWell({position:{x:Math.random()*n-n/2,y:Math.random()*p-p/2},density:1,radius:2.5*Math.random(),fillStyle:"black"}),l.push(m);h()},getScale:function(){return c},getGravityStrength:function(){return d.gravityStrength},getFrameRate:function(){return r}}}(window),
KeyMouseEventHandlers=function(a,b){function f(a){GravitySim.getScale();e.x=a.pageX-m.offsetLeft;e.y=a.pageY-m.offsetTop}function h(a){e["_"+a.which]=!0}function t(a){e["_"+a.which]=!1}function w(a){r["_"+a.which]=!0}function x(a){r["_"+a.which]=!1}var m,e={x:0,y:0},r={};return{init:function(b){m=b;a.onkeydown=w;a.onkeyup=x;m.onmousemove=f;m.onmousedown=h;m.onmouseup=t},getMousePosition:function(){return{x:e.x,y:e.y}},mouseButtonDown:function(a){a="_"+a;return e.hasOwnProperty(a)?e[a]:!1},mouseCode:{left:1,
middle:2,right:3},keyCode:{up:38,down:40,left:37,right:39,pageUp:33,pageDown:34,enter:13},keyDown:function(a){a="_"+a;return r.hasOwnProperty(a)?r[a]:!1}}}(window);function GravityWell(a){this.position=a.position||{x:0,y:0};this.force={x:0,y:0};this.velocity=a.velocity||{x:0,y:0};this.density=a.density||1;this.radius=a.radius||5;this.mass=4/3*Math.PI*this.radius*this.radius*this.radius*this.density;this.fillStyle=a.fillStyle||"black";this.useGradient=a.useGradient||!1}
GravityWell.prototype={addForceFrom:function(a){var b=this.position.x-a.position.x,f=this.position.y-a.position.y,h=this.distance(a),b=b/h,f=f/h,t=GravitySim.getGravityStrength();this.force.x+=t*-b*this.mass*a.mass/h;this.force.y+=t*-f*this.mass*a.mass/h},updatePosition:function(){var a=this.force.x/this.mass,b=this.force.y/this.mass,f=GravitySim.getFrameRate();this.velocity.x+=a*f;this.velocity.y+=b*f;this.position.x+=this.velocity.x*f;this.position.y+=this.velocity.y*f;this.force.x=0;this.force.y=
0},render:function(a){var b=this.fillStyle;this.useGradient&&(b=a.createRadialGradient(this.position.x,this.position.y,0,this.position.x,this.position.y,this.radius),b.addColorStop(0,this.fillStyle),b.addColorStop(1,"white"));a.beginPath();a.fillStyle=b;a.arc(this.position.x,this.position.y,this.radius,0,2*Math.PI);a.fill();a.closePath()},distance:function(a){return Misc.dist(this.position,a.position)}};
var Misc=function(){return{dist:function(a,b){if(!(a.hasOwnProperty("x")&&a.hasOwnProperty("y")&&b.hasOwnProperty("x")&&b.hasOwnProperty("y")))throw TypeError("Parameters must be objects with the properties x and y.");var f=b.x-a.x,h=b.y-a.y;return Math.sqrt(f*f+h*h)}}}(void 0);window.onload=function(){var a=document.createElement("canvas"),b=document.createElement("center");a.width=1500;a.height=750;document.body.appendChild(b);b.appendChild(a);GravitySim.init(1/60,a)};