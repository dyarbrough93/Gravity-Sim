function GravityWell(e){this.position=e.position||{x:0,y:0};this.force={x:0,y:0};this.velocity=e.velocity||{x:0,y:0};this.density=e.density||1;this.radius=e.radius||5;this.mass=4/3*Math.PI*this.radius*this.radius*this.radius*this.density;this.fillStyle=e.fillStyle||"black";this.useGradient=e.useGradient||false}var GravitySim=function(window,undefined){function init(e,t){frameRate=e;frameLength=frameRate*1e3;scale=1;suns=[];satellites=[];canvas=t;initCanvasCtx();initEventListeners();initSettings();initGUI();initSuns(25);initSatellites(150);loop()}function initCanvasCtx(){ctx=canvas.getContext("2d");ctx.webkitImageSmoothingEnabled=true;cw=canvas.width;ch=canvas.height}function initEventListeners(){KeyMouseEventHandlers.init(canvas);canvas.oncontextmenu=function(){return false};window.onresize=function(){cw=canvas.width=window.innerWidth;ch=canvas.height=window.innerHeight}}function initSettings(){settings={zoomSpeed:.015,panSpeed:50,minScale:.1,maxScale:3,gravityStrength:.01}}function initGUI(){gui=new dat.GUI;gui.add(settings,"zoomSpeed",.01,.05);gui.add(settings,"panSpeed",15,100);gui.add(settings,"minScale",.01,1);gui.add(settings,"maxScale",3,10);gui.add(settings,"gravityStrength",0,.1)}function initSuns(e){for(var t=0;t<e;t++){var n=new GravityWell({position:{x:Math.random()*cw-cw/2,y:Math.random()*ch-ch/2},density:1,radius:Math.random()*50,fillStyle:"red",useGradient:true});suns.push(n)}}function initSatellites(e){for(var t=0;t<e;t++){var n=new GravityWell({position:{x:Math.random()*cw-cw/2,y:Math.random()*ch-ch/2},density:1,radius:Math.random()*2.5,fillStyle:"black"});satellites.push(n)}}function loop(){updateScene();renderScene();setTimeout(loop,frameLength)}function updateScene(){updateWells();createNewSuns();createNewSatellites();panScene();scaleScene()}function updateWells(){for(var e=0;e<suns.length;e++){for(var t=0;t<satellites.length;t++){suns[e].addForceFrom(satellites[t])}}for(var e=0;e<satellites.length;e++){for(var t=0;t<suns.length;t++){satellites[e].addForceFrom(suns[t])}}for(var e=0;e<suns.length;e++){suns[e].updatePosition()}for(var e=0;e<satellites.length;e++){satellites[e].updatePosition()}}function createNewSuns(){var eh="KeyMouseEventHandlers";var mousepos=eval(eh).getMousePosition();if(eval(eh).mouseButtonDown(eval(eh).mouseCode.left)){if(!creatingSun){creatingSun=true;newSunPos=eval(eh).getMousePosition()}}else if(creatingSun){creatingSun=false;var newRadius=Misc.dist(mousepos,newSunPos);suns.push(new GravityWell({position:{x:(newSunPos.x-cw/2)/scale,y:(newSunPos.y-ch/2)/scale},density:1,radius:newRadius,fillStyle:"red",useGradient:true}))}if(creatingSun){ctx.beginPath();var currRadius=Misc.dist(mousepos,newSunPos);ctx.arc(newSunPos.x,newSunPos.y,currRadius,0,Math.PI*2);ctx.fill()}}function createNewSatellites(){var eh="KeyMouseEventHandlers";var mousepos=eval(eh).getMousePosition();if(eval(eh).mouseButtonDown(eval(eh).mouseCode.right))satellites.push(new GravityWell({position:{x:(mousepos.x-cw/2)/scale,y:(mousepos.y-ch/2)/scale},density:1,radius:2,fillStyle:"black"}))}function panScene(){var hdir,vdir;var eh="KeyMouseEventHandlers";if(eval(eh).keyDown(eval(eh).keyCode.left))hdir=1;else if(eval(eh).keyDown(eval(eh).keyCode.right))hdir=-1;else if(eval(eh).keyDown(eval(eh).keyCode.up))vdir=1;else if(eval(eh).keyDown(eval(eh).keyCode.down))vdir=-1;if(hdir){suns.forEach(function(e){e.position.x+=hdir*settings.panSpeed});satellites.forEach(function(e){e.position.x+=hdir*settings.panSpeed})}if(vdir){suns.forEach(function(e){e.position.y+=vdir*settings.panSpeed});satellites.forEach(function(e){e.position.y+=vdir*settings.panSpeed})}}function scaleScene(){var eh="KeyMouseEventHandlers";if(eval(eh).keyDown(eval(eh).keyCode.pageUp))if(scale<settings.maxScale)scale+=settings.zoomSpeed*scale;else scale=settings.maxScale;else if(eval(eh).keyDown(eval(eh).keyCode.pageDown))if(scale>settings.minScale)scale-=settings.zoomSpeed*scale;else scale=settings.minScale}function renderScene(){ctx.save();ctx.translate(cw/2,ch/2);ctx.scale(scale,scale);ctx.fillStyle="rgba(255,255,255,.5)";ctx.fillRect(-cw/2/scale,-ch/2/scale,cw/scale,ch/scale);suns.forEach(function(e){e.render(ctx)});satellites.forEach(function(e){e.render(ctx)});ctx.restore()}function getScale(){return scale}function getFrameRate(){return frameRate}function getGravityStrength(){return settings.gravityStrength}var frameRate;var frameLength;var scale;var suns;var satellites;var canvas;var cw,ch;var ctx;var gui;var settings;var creatingSun;var newSunPos;return{init:init,getScale:getScale,getGravityStrength:getGravityStrength,getFrameRate:getFrameRate}}(window);var KeyMouseEventHandlers=function(e,t){function r(t){n=t;e.onkeydown=d;e.onkeyup=v;n.onmousemove=o;n.onmousedown=f;n.onmouseup=l}function o(e){var t=GravitySim.getScale();i.x=e.pageX-n.offsetLeft;i.y=e.pageY-n.offsetTop}function u(){return{x:i.x,y:i.y}}function a(e){e="_"+e;if(i.hasOwnProperty(e))return i[e];else return false}function f(e){var t="_"+e.which;i[t]=true}function l(e){var t="_"+e.which;i[t]=false}function p(e){e="_"+e;if(c.hasOwnProperty(e))return c[e];else return false}function d(e){var t="_"+e.which;c[t]=true}function v(e){var t="_"+e.which;c[t]=false}var n;var i={x:0,y:0};var s={left:1,middle:2,right:3};var c={};var h={up:38,down:40,left:37,right:39,pageUp:33,pageDown:34,enter:13};return{init:r,getMousePosition:u,mouseButtonDown:a,mouseCode:s,keyCode:h,keyDown:p}}(window);GravityWell.prototype={addForceFrom:function(e){var t=this.position.x-e.position.x,n=this.position.y-e.position.y;var r=this.distance(e);var i=t/r;var s=n/r;var o=GravitySim.getGravityStrength();this.force.x+=o*-i*this.mass*e.mass/r;this.force.y+=o*-s*this.mass*e.mass/r},updatePosition:function(){var e=this.force.x/this.mass,t=this.force.y/this.mass;var n=GravitySim.getFrameRate();this.velocity.x+=e*n;this.velocity.y+=t*n;this.position.x+=this.velocity.x*n;this.position.y+=this.velocity.y*n;this.force.x=0;this.force.y=0},render:function(e){var t=this.fillStyle;if(this.useGradient){t=e.createRadialGradient(this.position.x,this.position.y,0,this.position.x,this.position.y,this.radius);t.addColorStop(0,this.fillStyle);t.addColorStop(1,"white")}e.beginPath();e.fillStyle=t;e.arc(this.position.x,this.position.y,this.radius,0,Math.PI*2);e.fill();e.closePath()},distance:function(e){var t=this.position.x-e.position.x;var n=this.position.y-e.position.y;return Math.sqrt(t*t+n*n)}};var Misc=function(){function e(e,t){if(!e.hasOwnProperty("x")||!e.hasOwnProperty("y")||!t.hasOwnProperty("x")||!t.hasOwnProperty("y"))throw TypeError("Parameters must be objects with the properties x and y.");var n=t.x-e.x;var r=t.y-e.y;return Math.sqrt(n*n+r*r)}return{dist:e}}(undefined);window.onload=function(){var e=document.createElement("canvas");var t=document.createElement("center");e.width=1500;e.height=750;document.body.appendChild(t);t.appendChild(e);GravitySim.init(1/60,e)}